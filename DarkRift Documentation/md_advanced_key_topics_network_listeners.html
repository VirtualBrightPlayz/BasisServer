<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DarkRift: Network Listeners</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dr2_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dr2_logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">DarkRift<span id="projectnumber">&#160;2.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_advanced_key_topics_network_listeners.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Network Listeners </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Network Listeners are specialized plugins that provide the lowest level of networking to DarkRift. They are responsible for maintaining connections, passing the data over the network, and implementing the different send modes available in DarkRift.</p>
<p >The server is shipped with two network listeners and you've probably already used at least one. The first is the BichannelListener which sends reliable data via TCP and unreliable data via UDP. This is the default for the console based server. The second is a modification of the BichannelListener, the CompatibilityBichannelListener, that uses the same system but via a different .NET API to circumnavigate some bugs in hosts like Unity.</p>
<h1><a class="anchor" id="autotoc_md67"></a>
Enabling a Network Listener</h1>
<p >NetworkListeners are configured in the listeners tag of the server configuration file. Each should have a unique name to identify them and a type which tells DR what Network Listener plugin to load. You can mix and match NetworkListeners to allow connections from multiple ports or via different protocols simultaneously etc.</p>
<p >An example of a listener element, that would create a BichannelListener, would be: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">listener</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;DefaultListener&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;BichannelListener&quot;</span> <span class="keyword">address</span>=<span class="stringliteral">&quot;0.0.0.0&quot;</span> <span class="keyword">port</span>=<span class="stringliteral">&quot;4296&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">settings</span> <span class="keyword">noDelay</span>=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
<div class="line">&lt;/<span class="keywordtype">listener</span>&gt;</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md68"></a>
Custom Network Listeners</h1>
<p >It is possible to create your own NetworkListeners in a very similar way to creating plugins. Instead of inheriting from Plugin you must inherit from NetworkListener. When a new client connects you should create an instance of a NetworkServerConnection which DarkRift will use to communicate with that client.</p>
<p ><b>Note that it is assumed your NetworkListeners will be thread safe!</b> </p><div class="fragment"><div class="line"><span class="keyword">class </span>MyNetworkListener : NetworkListener</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> Version Version =&gt; <span class="keyword">new</span> Version(1, 0, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> MyNetworkListener(NetworkListenerLoadData pluginLoadData) : base(pluginLoadData)</div>
<div class="line">    {</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> StartListening()</div>
<div class="line">    {</div>
<div class="line">        <span class="comment">//When a new client connects we need to call RegisterConnection(NetworkServerConnection connection)</span></div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> <div class="fragment"><div class="line"><span class="keyword">class </span>MyNetworkServerConnection : NetworkServerConnection</div>
<div class="line">{</div>
<div class="line">        <span class="comment">//Whether we&#39;re connected</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> ConnectionState ConnectionState { <span class="keyword">get</span>; }</div>
<div class="line"> </div>
<div class="line">        <span class="comment">//A list of endpoints we&#39;re connected to on the client</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> IEnumerable&lt;IPEndPoint&gt; RemoteEndPoints { <span class="keyword">get</span>; }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//Given a named endpoint this should return that</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> IPEndPoint GetRemoteEndPoint(<span class="keywordtype">string</span> name)</div>
<div class="line">        {</div>
<div class="line"> </div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//Called once for initialization</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> StartListening()</div>
<div class="line">        {</div>
<div class="line">        </div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//Sends a message reliably...</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> SendMessageReliable(MessageBuffer message)</div>
<div class="line">        {</div>
<div class="line">        </div>
<div class="line">        }</div>
<div class="line">                </div>
<div class="line">        <span class="comment">//...Sends a message unreliably!</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> SendMessageUnreliable(MessageBuffer message)</div>
<div class="line">        {</div>
<div class="line">        </div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//Called when the server wants to disconnect the client</span></div>
<div class="line">        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> Disconnect()</div>
<div class="line">        {</div>
<div class="line">        </div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">//We should call HandleMessageReceived(MessageBuffer message, SendMode sendMode) when we get a new message from the client</span></div>
<div class="line">        <span class="comment">//And HandleDisconnection(...) if the client disconnects</span></div>
<div class="line">}</div>
</div><!-- fragment --><p> Naturally, an appropriate connector is also required on the client side. This is done by inheriting from NetworkClientConnection and passing an instance to DarkRiftClient.Connect while connecting. This is very similar to implementing NetworkServerConnection: </p><div class="fragment"><div class="line"><span class="keyword">class </span>MyNetworkClientConnection : NetworkClientConnection</div>
<div class="line">{</div>
<div class="line">    <span class="comment">//Whether we&#39;re connected</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> ConnectionState ConnectionState { <span class="keyword">get</span>; }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//A list of endpoints we&#39;re connected to on the server</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> IEnumerable&lt;IPEndPoint&gt; RemoteEndPoints { <span class="keyword">get</span>; }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Given a named endpoint this should return that</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> IPEndPoint GetRemoteEndPoint(<span class="keywordtype">string</span> name)</div>
<div class="line">    {</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Called when DarkRiftClient.Connect is called</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Connect()</div>
<div class="line">    {</div>
<div class="line">    </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">//Sends a message reliably...</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> SendMessageReliable(MessageBuffer message)</div>
<div class="line">    {</div>
<div class="line">    </div>
<div class="line">    }</div>
<div class="line">                </div>
<div class="line">    <span class="comment">//...Sends a message unreliably!</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> SendMessageUnreliable(MessageBuffer message)</div>
<div class="line">    {</div>
<div class="line">    </div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//Called when the server wants to disconnect the client</span></div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> Disconnect()</div>
<div class="line">    {</div>
<div class="line">        </div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="comment">//We should call HandleMessageReceived(MessageBuffer message, SendMode sendMode) when we get a new message from the client</span></div>
<div class="line">    <span class="comment">//And HandleDisconnection(...) if the client disconnects</span></div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
