<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DarkRift: Omnomnomnom</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dr2_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dr2_logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">DarkRift<span id="projectnumber">&#160;2.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_getting_started_9_omnomnomnom.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Omnomnomnom </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Let’s eat. I feel like our strange circles floating around their empty abyss are probably getting hungry by now…</p>
<p >For this I’m deliberately going to leave out simple code snippets since you should now have a good enough understanding to be able to add the easy bits yourself. If you’re struggling, go back and look through the previous chapters and the code you’ve already written and, if all else fails, look it up in the complete project.</p>
<p >Add a new C# file to our server plugin called <code>AgarFoodManager</code> and make the class a DarkRift plugin (first challenge!). Make sure you set <code>ThreadSafe</code> to <b>false</b> so you don’t have problems later!</p>
<p >Add a <code>HashSet</code> field called food that contains <code>FoodItem</code> objects and initialise it empty. Add the following definition of <code>FoodItem</code> to a new file: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>FoodItem : IEdible</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> ushort ID { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">float</span> Radius =&gt; 0.1f;</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">float</span> X { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">float</span> Y { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> ColorR { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> ColorG { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line">    <span class="keyword">public</span> <span class="keywordtype">byte</span> ColorB { <span class="keyword">get</span>; <span class="keyword">set</span>; }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> FoodItem(ushort ID, <span class="keywordtype">float</span> x, <span class="keywordtype">float</span> y, <span class="keywordtype">byte</span> colorR, <span class="keywordtype">byte</span> colorG, <span class="keywordtype">byte</span> colorB)</div>
<div class="line">    {</div>
<div class="line">        this.ID = ID;</div>
<div class="line">        this.X = x;</div>
<div class="line">        this.Y = y;</div>
<div class="line">        this.ColorR = colorR;</div>
<div class="line">        this.ColorG = colorG;</div>
<div class="line">        this.ColorB = colorB;</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> Now add the following definition of <code>IEdible</code> to a new file and make Player implement the <code>IEdible</code> interface (see where this is going?). </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">interface </span>IEdible</div>
<div class="line">{</div>
<div class="line">    ushort ID { <span class="keyword">get</span>; }</div>
<div class="line">    <span class="keywordtype">float</span> X { <span class="keyword">get</span>; }</div>
<div class="line">    <span class="keywordtype">float</span> Y { <span class="keyword">get</span>; }</div>
<div class="line">    <span class="keywordtype">float</span> Radius { <span class="keyword">get</span>; }</div>
<div class="line">}</div>
</div><!-- fragment --><p> In the food manager <b>constructor</b> add a number of <b>food</b> items (I did 20) with random values to the food <code>HashSet</code> similarly to how we assigned values to the players. For the <b>ID</b> field just assign them <b>incrementing</b> values from <b>0</b> so we can identify then uniquely later.</p>
<p >Now for a more challenging part! Make it so that when a player <b>connects</b> to the server the <code>AgarFoodManager</code> sends the <b>latest positions</b> of all <b>food</b> to the new client, ideally this should be in <b>one</b> message as we did before with the players (hint!) but if you’re struggling just implement it as 1 message per food item and get that working first. Create a dedicated food spawn <b>tag</b> for this.</p>
<p >Switching to the Unity project, add a <code>FoodManager</code> MonoBehaviour and attach it to the <code>Network</code> object. In this script, you’ll need to pass <b>in</b> the <b>client</b> and <b>receive</b> the <b>list of food</b> that the server sends, again you can probably reuse some of the player code here. Make sure you track the food items you add using a <b>dictionary</b> (ID as key) so that we can access them later.</p>
<p >You should be able to test now and see lots of food appear on the map with your players!</p>
<p >While we’re testing, add some code to set the <code>CameraFollow.Target</code> on our <code>Main Camera</code> to our player so that it follows them around.</p>
<p >Let’s switch back to <code>AgarPlayerManager</code> and add in some code to actually eat the items of food! In our <code>MovementMessageReceived</code> method add the following code: </p><div class="fragment"><div class="line">player.X = newX;</div>
<div class="line">player.Y = newY;</div>
<div class="line"> </div>
<div class="line">AgarFoodManager foodManager = PluginManager.GetPluginByType&lt;AgarFoodManager&gt;();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">foreach</span> (FoodItem food <span class="keywordflow">in</span> foodManager.Food)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (Math.Pow(player.X - food.X, 2) + Math.Pow(player.Y - food.Y, 2) &lt; Math.Pow(player.Radius, 2))</div>
<div class="line">    {</div>
<div class="line">        player.Radius += food.Radius;</div>
<div class="line">        SendRadiusUpdate(player);</div>
<div class="line">        foodManager.Eat(food);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p> It should be fairly easy to make out the <b>Pythagoras</b> in there. Essentially, we’re just checking the <b>distance</b> between the <b>food</b> and the <b>player</b> is less than the player’s <b>size</b> in a makeshift collision routine, we can then increase our player’s size appropriately and “eat” the food.</p>
<p >This won’t compile yet because there’s three missing items; before we add them, let’s look at the <code>GetPluginsByType</code> call. Since DarkRift handles the instantiation of plugins you can’t get a reference to other plugins without querying DarkRift because DarkRift is the entity with that reference so that’s exactly what we do here.</p>
<p >Hopefully you can see that the <code>Food</code> property and the <code>Eat</code> method need to be implemented in the <code>AgarFoodManager</code> class so add the following line: </p><div class="fragment"><div class="line"><span class="keyword">public</span> IEnumerable&lt;FoodItem&gt; Food =&gt; food;</div>
</div><!-- fragment --><p> The <code>SendRadiusUpdate</code> function should <b>send</b> a message containing the <b>new radius</b> to every client using a <b>radius update tag</b>, you’ll also need to check the tag in <code>NetworkPlayerManager</code> on the client and either call <code>SetMovePosition</code> or <code>SetRadius</code> on the <code>AgarObject</code> so it does the right action!</p>
<p >Lastly, have a go at implementing the <code>Eat</code> method. All this needs to do is <b>move</b> the item of food to another, <b>random location</b> and <b>inform</b> all connected clients of this. Add yourself another <b>tag</b> value for issuing the move command.</p>
<p >The only thing that needs adding on the client now is some code to handle the movement of food items, everything else is already handled by the server side logic! Have a go at adding it yourself.</p>
<p >If you have trouble with the collisions not lining up with your graphics try adjusting the scale value on the AgarObjects. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
