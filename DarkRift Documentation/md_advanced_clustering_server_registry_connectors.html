<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DarkRift: Writing Server Registry Connectors</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dr2_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dr2_logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">DarkRift<span id="projectnumber">&#160;2.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_advanced_clustering_server_registry_connectors.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Writing Server Registry Connectors </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >Server registry connectors are a type of DarkRift plugin that provide DarkRift with a directory of the servers in a cluster and inform DarkRift of new servers joining or other servers leaving the cluster.</p>
<h1><a class="anchor" id="autotoc_md20"></a>
Responsibilities</h1>
<p >There are three main responsibility of a Server Registry:</p><ol type="1">
<li>Inform DarkRift when a new server joins the cluster</li>
<li>Inform DarkRift when a server leaves the cluster</li>
<li>Monitor for DarkRift servers that have unexpectedly left (optional, see later)</li>
</ol>
<h1><a class="anchor" id="autotoc_md21"></a>
ServerRegistryConnector</h1>
<p >The <code>ServerRegistryConnector</code> is the base plugins type of all server registry connectors. There are two additional methods that require implementation, <code>RegisterServer</code> and <code>DeregisterServer</code> which are to add and remove the current server to/from the registry respectively. </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>MyServerRegistryConnector : ServerRegistryConnector</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> ThreadSafe =&gt; <span class="keyword">true</span>;</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">public</span> <span class="keyword">override</span> Version Version =&gt; <span class="keyword">new</span> Version(1, 0, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> ushort RegisterServer(<span class="keywordtype">string</span> group, IPAddress address, ushort port, NameValueCollection properties)</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> DeregisterServer()</div>
<div class="line">    {</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><p >The <code>properties</code> parameter of <code>RegisterServer</code> is designed to allow DarkRift to pass additional information in future without needing to make breaking changes to the API.</p>
<p >When the connector detects that a server has joined or left the cluster it should call <code>HandleServerJoin(ushort id, string group, string host, ushort port, IDictionary&lt;string, string&gt; properties)</code> or <code>HandleServerLeave(ushort id)</code> respectively. These calls can be made for the current server and do not need to be filtered to the groups the current server needs to connect to, DarkRift will handle that logic for you.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
Detecting Unavailable Servers</h1>
<p >Ideally a server registry would automatically watch the DarkRift server (e.g. via the HTTP health check) and automatically remove the server if it is unavailable. However, practically for some registries this is not possible therefore DarkRift provides a virtual method <code>HandleConnectionFailure</code> that a connector can override to be informed if DarkRift cannot connect to a server for some reason (including if the connection is lost and unable to be recovered). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
