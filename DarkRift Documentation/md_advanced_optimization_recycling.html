<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DarkRift: Recycling</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dr2_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dr2_logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">DarkRift<span id="projectnumber">&#160;2.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_advanced_optimization_recycling.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Recycling </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >DarkRift recycles a number of commonly used objects to relieve the pressure on the garbage collector and to speed up instantiate of the objects. This page will tell you more about the objects and customization available.</p>
<h1><a class="anchor" id="autotoc_md94"></a>
Overview</h1>
<p >DarkRift recycles 4 objects currently:</p><ul>
<li>DarkRiftWriters</li>
<li>DarkRiftReaders</li>
<li>Messages</li>
<li>SocketAsyncEventArgs (used by DarkRift for all socket operations)</li>
</ul>
<p >The instances of these objects are all managed by the ObjectCaches which are unique and static for each thread allowing very fast access to them. This does mean you can starve a thread of resources by retrieving instances from one cache and returning them to another.</p>
<p >To simplify recycling outside of DarkRift, the writers, readers and messages are IDisposable so that they can be used within using blocks to automatically dispose of them once they leave its scope. This has the added benefit that you cannot reference an recyclable object once it has been disposed since that would give you non-deterministic behaviour. Once Dispose has been called on the object you should not make reference to it again as it will be subject to change contents unexpectedly.</p>
<p >In future the following types will also be recycled:</p><ul>
<li>All byte arrays used by DarkRift</li>
<li>All EventArg objects passed on event invocation</li>
</ul>
<h1><a class="anchor" id="autotoc_md95"></a>
Customization</h1>
<p >The object cache can be customized at start up on both the client and server to configure different sized pools. For example, if you require a large number of DarkRiftReaders to exist concurrently on a thread you could increase the <code>maxCachedReaders</code> value to ensure there is enough instances in the pool to avoid reallocating and dereferencing each time.</p>
<p >Customization should be avoided unless you are sure it will help since overallocating will result in wasted memory and underallocating can severely degrade performance and add unecessary GC pressure. To get the best results you should be using a profiler.</p>
<p >It is important to remember that changes to customization may not take effect if multiple servers/clients are or have been in use this is because the object caches are unique to each thread not to each server/client. When the server initializes, it attempts to set the parameters of the object caches but will not be able to if another initialization (e.g. from another client) has taken place since threads are shared between them. You can see in server logs if this has occured; there is currently no way to see the result in the client. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
