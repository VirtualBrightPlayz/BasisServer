<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DarkRift: Getting Started</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=DM+Sans&display=swap" rel="stylesheet">
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="dr2_stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="dr2_logo.svg"/></td>
  <td id="projectalign">
   <div id="projectname">DarkRift<span id="projectnumber">&#160;2.11.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('md_advanced_clustering_getting_started.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p >To get started with server clustering you will need to setup a few things. This page will take you through the main steps to setting up your cluster.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
ServerRegistryConnector</h1>
<p >The first step is to choose an appropriate <code>ServerRegistryConnector</code> for your cluster. This will be responsible for discovering servers within the cluster and passing that information to DarkRift.</p>
<p >At the time of writing the only official connector is for <a href="https://www.consul.io/">Hashicorp Consul</a>, and it can be downloaded <a href="https://github.com/DarkRiftNetworking/consul-server-registry-connector">here</a>. Other official connectors and also third party connectors may be available and may be more appropriate for your deployment.</p>
<p >It's worth noting that the connector is completely isolated from any code you need to write for clustering, therefore the choice of connector can be easily changed if necessary.</p>
<p >The connector is like any other plugin and must be placed in one of the plugin search paths. To enable the connector you must explicitly define it in your server configuration, for example: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">serverRegistry</span> <span class="keyword">advertisedHost</span>=<span class="stringliteral">&quot;...&quot;</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">serverRegistryConnector</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;ConsulServerRegistryConnector&quot;</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">settings</span> <span class="keyword">consulAddress</span>=<span class="stringliteral">&quot;http://localhost:8500&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">serverRegistryConnector</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">serverRegistry</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md2"></a>
Cluster.config</h1>
<p >In order for DarkRift to establish the correct network of connections you need to specify a <code>Cluster.config</code> file. This file is similar to the <code>Server.config</code> file but instead of describing the operation of a single server this file defines the groups in the cluster and how they are related to each other.</p>
<p >Before writing this file it is important to have thoroughly considered your architecture. While it is easy to change the architecture in DarkRift it may not be so simple to change your own logic!</p>
<p >A simple <code>Cluster.config</code> file might look like this: </p><div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;utf-8&quot;</span> ?&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">cluster</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">groups</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">group</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Group1&quot;</span> <span class="keyword">visibility</span>=<span class="stringliteral">&quot;external&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">connectsTo</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Group2&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">group</span>&gt;</div>
<div class="line"> </div>
<div class="line">    &lt;<span class="keywordtype">group</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;Group2&quot;</span> <span class="keyword">visibility</span>=<span class="stringliteral">&quot;internal&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">groups</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">cluster</span>&gt;</div>
</div><!-- fragment --><p >Each group is specified with a name and a visibility. The name is what will be used to reference this group in both server logic and by the registry connector. The visibility defines whether this server expects <code>DarkRiftClient</code> objects to connect to it (<code>external</code>) or other servers to connect to it (<code>internal</code>).</p>
<p >Each group can contain any number of <code>connectsTo</code> elements which specify that the servers in a group should establish connections to all other servers in another group. In the above configuration servers in <code>Group1</code> will automatically establish connections to servers in <code>Group2</code>.</p>
<p >A <code>connectsTo</code> element indicates the group is the downstream group in the connection and the group specified as being connected to is the upstream.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Example</h2>
<p >As an example, the following architecture would be defined by this <code>Cluster.config</code>:</p>
<p ><img src="~/images/advanced/clustering/example_architecture.png" alt="Architecture Diagram" title="Example Architecture" class="inline"/></p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span> <span class="keyword">encoding</span>=<span class="stringliteral">&quot;utf-8&quot;</span> ?&gt;</div>
<div class="line"> </div>
<div class="line">&lt;<span class="keywordtype">cluster</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">groups</span>&gt;</div>
<div class="line">    &lt;<span class="keywordtype">group</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;ClientServers&quot;</span> <span class="keyword">visibility</span>=<span class="stringliteral">&quot;external&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">connectsTo</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SocialServers&quot;</span> /&gt;</div>
<div class="line">      &lt;<span class="keywordtype">connectsTo</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;WorldServers&quot;</span> /&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">group</span>&gt;</div>
<div class="line"> </div>
<div class="line">    &lt;<span class="keywordtype">group</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;SocialServers&quot;</span> <span class="keyword">visibility</span>=<span class="stringliteral">&quot;internal&quot;</span> /&gt;</div>
<div class="line">    &lt;<span class="keywordtype">group</span> <span class="keyword">name</span>=<span class="stringliteral">&quot;WorldServers&quot;</span> <span class="keyword">visibility</span>=<span class="stringliteral">&quot;internal&quot;</span> /&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">groups</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">cluster</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md4"></a>
Server Group and Advertised Connection Details</h1>
<p >Each server in a cluster needs to know what group it belongs to in order to establish the correct connections to other groups. Similarly, every server needs to have an advertised address and host with which it can be connected to by other servers, these details are stored in the registry.</p>
<p >To specify this the following properties need to be added to the <code>server</code> element of the <code>Server.config</code> file: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">server</span> ... <span class="keyword">serverGroup</span>=<span class="stringliteral">&quot;Group1&quot;</span>/&gt;</div>
</div><!-- fragment --><p> And the following to the <code>serverRegistry</code> element: </p><div class="fragment"><div class="line">&lt;<span class="keywordtype">serverRegistry</span> <span class="keyword">advertisedHost</span>=<span class="stringliteral">&quot;hostname&quot;</span> <span class="keyword">advertisedPort</span>=<span class="stringliteral">&quot;4296&quot;</span>&gt;</div>
<div class="line">  ...</div>
</div><!-- fragment --><p >The <code>severGroup</code> must be the name of a group specified in the <code>Cluster.config</code> file.</p>
<p >The <code>advertisedHost</code> can be an IP address or a DNS name.</p>
<p >The <code>advertisedPort</code> value does not need to be the same as a port specified for a network listener to operate on, this defaults to 4298. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
